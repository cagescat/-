<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­çˆµå°å§çš„å©šäº‹ - è´µæ—å©šæ‹æ¸¸æˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cormorant Garamond', serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a0f0f 0%, #2d1b1b 100%);
            color: #e8d8c3;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(120, 80, 50, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(100, 60, 30, 0.1) 0%, transparent 20%);
            pointer-events: none;
            z-index: -1;
        }
        
        #game-container {
            width: 100%;
            max-width: 420px;
            height: 720px;
            background: 
                linear-gradient(160deg, #3d2819 0%, #2c1c12 30%, #1a120b 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M20,20 L80,20 L80,80 L20,80 Z" fill="none" stroke="%235a3d2c" stroke-width="2" stroke-opacity="0.3"/><path d="M10,10 L90,10 L90,90 L10,90 Z" fill="none" stroke="%235a3d2c" stroke-width="1" stroke-opacity="0.2"/></svg>');
            border-radius: 16px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.6),
                inset 0 0 0 1px rgba(200, 150, 100, 0.3),
                inset 0 0 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #8b7355;
        }
        
        /* è´µæ—çº¹ç« è£…é¥° */
        .heraldic-decoration {
            position: absolute;
            pointer-events: none;
            z-index: 1;
            opacity: 0.15;
        }
        
        .decoration-1 {
            top: 10px;
            left: 10px;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,10 Q70,30 90,50 Q70,70 50,90 Q30,70 10,50 Q30,30 50,10 Z" fill="none" stroke="%23d4af37" stroke-width="2"/><circle cx="50" cy="50" r="20" fill="none" stroke="%23d4af37" stroke-width="1.5"/></svg>');
            background-size: contain;
        }
        
        .decoration-2 {
            bottom: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M20,50 L50,20 L80,50 L50,80 Z" fill="none" stroke="%23d4af37" stroke-width="2"/><path d="M35,50 L50,35 L65,50 L50,65 Z" fill="none" stroke="%23d4af37" stroke-width="1.5"/></svg>');
            background-size: contain;
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  - è´µæ—é£æ ¼ */
        #status-bar {
            background: linear-gradient(to right, #5d4037 0%, #3e2723 100%);
            color: #d4af37;
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #8b7355;
            font-family: 'Cinzel', serif;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }
        
        #status-bar::after {
            content: "";
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
        }
        
        #month-display {
            background-color: rgba(26, 18, 11, 0.7);
            padding: 6px 14px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            border: 1px solid #8b7355;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        
        #month-display i {
            margin-right: 8px;
            color: #d4af37;
        }
        
        #reputation {
            display: flex;
            align-items: center;
            background-color: rgba(26, 18, 11, 0.7);
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid #8b7355;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4);
        }
        
        #reputation i {
            margin-right: 8px;
            color: #ffd700;
        }
        
        /* æ¸¸æˆæ ‡é¢˜ */
        #game-header {
            padding: 18px;
            text-align: center;
            background: linear-gradient(to bottom, rgba(61, 40, 25, 0.9) 0%, rgba(44, 28, 18, 0.9) 100%);
            border-bottom: 1px solid #6d4c3d;
            position: relative;
            overflow: hidden;
        }
        
        #game-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
        }
        
        #game-header h1 {
            font-size: 22px;
            color: #d4af37;
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            font-family: 'Cinzel', serif;
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
        }
        
        #game-header h1::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 10%;
            width: 80%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #8b7355, transparent);
        }
        
        #game-header p {
            font-size: 13px;
            color: #c9b29a;
            font-style: italic;
            margin-top: 5px;
        }
        
        /* å¯¹è¯åŒºåŸŸ */
        #chat-area {
            flex-grow: 1;
            padding: 18px;
            overflow-y: auto;
            background-color: rgba(26, 18, 11, 0.85);
            display: flex;
            flex-direction: column;
            gap: 14px;
            scroll-behavior: smooth;
            background-image: 
                linear-gradient(rgba(139, 115, 85, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 115, 85, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .message {
            max-width: 88%;
            padding: 14px 18px;
            border-radius: 12px;
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            animation: messageAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(139, 115, 85, 0.3);
        }
        
        @keyframes messageAppear {
            0% { 
                opacity: 0; 
                transform: translateY(15px) scale(0.95); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #5d4037 0%, #3e2723 100%);
            align-self: flex-end;
            border-top-right-radius: 4px;
            color: #e8d8c3;
            border-left: 3px solid #d4af37;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.2);
        }
        
        .ai-message {
            background: linear-gradient(135deg, #3e2723 0%, #261a13 100%);
            align-self: flex-start;
            border-top-left-radius: 4px;
            color: #e8d8c3;
            border-right: 3px solid #8b7355;
        }
        
        .message-sender {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            color: #d4af37;
            font-family: 'Cinzel', serif;
            letter-spacing: 0.5px;
        }
        
        .message-sender img {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 1px solid #8b7355;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        }
        
        .message-content {
            font-size: 15px;
            line-height: 1.6;
        }
        
        .system-message {
            background: linear-gradient(135deg, rgba(44, 28, 18, 0.9) 0%, rgba(61, 40, 25, 0.9) 100%);
            align-self: center;
            text-align: center;
            font-size: 13px;
            color: #c9b29a;
            border-radius: 10px;
            padding: 10px 16px;
            border: 1px solid #6d4c3d;
            font-style: italic;
            max-width: 95%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        
        /* è¡ŒåŠ¨é€‰æ‹©åŒºåŸŸ - ç²¾ç®€ä¸ºä¸€è¡Œ */
        #action-area {
            padding: 12px 18px;
            background: linear-gradient(to top, #3e2723 0%, #2c1c12 100%);
            border-top: 2px solid #6d4c3d;
            position: relative;
            min-height: 80px;
        }
        
        #action-area::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af37, transparent);
        }
        
        #action-title {
            font-size: 13px;
            font-weight: 700;
            color: #d4af37;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-family: 'Cinzel', serif;
            white-space: nowrap;
        }
        
        #action-title i {
            margin-right: 8px;
            color: #ffd700;
            font-size: 12px;
        }
        
        /* è¡ŒåŠ¨æŒ‰é’®å®¹å™¨ - å•è¡Œæ°´å¹³æ»šåŠ¨ */
        #action-buttons-container {
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding-bottom: 5px;
            scrollbar-width: thin;
            scrollbar-color: #8b7355 #2c1c12;
        }
        
        #action-buttons {
            display: inline-flex;
            gap: 8px;
            padding-right: 10px;
        }
        
        .action-btn {
            padding: 8px 12px;
            background: linear-gradient(to bottom, #8b7355 0%, #6d4c3d 100%);
            border: none;
            border-radius: 8px;
            color: #f5e9d9;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(212, 175, 55, 0.2);
            text-align: center;
            min-height: 36px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .action-btn:hover {
            background: linear-gradient(to bottom, #9c815e 0%, #7d5a44 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(212, 175, 55, 0.3);
            border-color: rgba(212, 175, 55, 0.4);
        }
        
        .action-btn:active {
            transform: translateY(0);
            transition: all 0.1s;
        }
        
        .action-btn i {
            font-size: 13px;
            flex-shrink: 0;
        }
        
        .action-btn span {
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80px;
        }
        
        /* è¡ŒåŠ¨ç‚¹æŒ‡ç¤ºå™¨ */
        #action-points {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 6px;
            font-size: 11px;
            color: #c9b29a;
        }
        
        .action-point {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #8b7355;
        }
        
        .action-point.used {
            background-color: #5d4037;
            opacity: 0.5;
        }
        
        .action-point.available {
            background-color: #d4af37;
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }
        
        /* åº•éƒ¨è¾“å…¥åŒºåŸŸ */
        #input-area {
            padding: 16px 18px;
            background: linear-gradient(to top, #2c1c12 0%, #1a120b 100%);
            border-top: 2px solid #5d4037;
            display: flex;
            gap: 12px;
            align-items: center;
            position: relative;
        }
        
        #input-area::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #8b7355, transparent);
        }
        
        #user-input {
            flex-grow: 1;
            padding: 12px 18px;
            border: 1px solid #6d4c3d;
            border-radius: 25px;
            background-color: rgba(26, 18, 11, 0.9);
            color: #e8d8c3;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.5);
        }
        
        #user-input:focus {
            border-color: #d4af37;
            box-shadow: 
                inset 0 2px 6px rgba(0, 0, 0, 0.5),
                0 0 0 3px rgba(212, 175, 55, 0.2);
        }
        
        #user-input::placeholder {
            color: #8b7355;
            font-style: italic;
        }
        
        #send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
            color: #1a120b;
            border: none;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #send-btn:hover {
            background: linear-gradient(135deg, #e6c158 0%, #c9a327 100%);
            transform: scale(1.08);
            box-shadow: 0 6px 12px rgba(212, 175, 55, 0.4);
        }
        
        #send-btn:active {
            transform: scale(0.95);
        }
        
        /* è§’è‰²å¤´åƒ */
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
        }
        
        .avatar-anne {
            border-color: #d4af37;
        }
        
        .avatar-cat-black {
            border-color: #3e2723;
        }
        
        .avatar-cat-pink {
            border-color: #8b7355;
        }
        
        /* è£…é¥°æ€§å…ƒç´  */
        .decoration {
            font-size: 16px;
            margin: 0 2px;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5));
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        #chat-area::-webkit-scrollbar,
        #action-buttons-container::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        #chat-area::-webkit-scrollbar-track,
        #action-buttons-container::-webkit-scrollbar-track {
            background: rgba(44, 28, 18, 0.8);
            border-radius: 4px;
        }
        
        #chat-area::-webkit-scrollbar-thumb,
        #action-buttons-container::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #8b7355 0%, #6d4c3d 100%);
            border-radius: 4px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        #chat-area::-webkit-scrollbar-thumb:hover,
        #action-buttons-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #9c815e 0%, #7d5a44 100%);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .typing-indicator {
            display: inline-block;
            margin-left: 10px;
        }
        
        .typing-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #d4af37;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite both;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        /* è´µæ—é£æ ¼é£˜èŠ± */
        .floating-element {
            position: absolute;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            animation: floatElement linear infinite;
        }
        
        @keyframes floatElement {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(730px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            height: 4px;
            background-color: rgba(139, 115, 85, 0.3);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8b7355, #d4af37);
            border-radius: 2px;
            width: 8.33%; /* 1/12 */
            transition: width 0.5s ease;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            #game-container {
                height: 100vh;
                max-height: 720px;
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
            
            .action-btn {
                padding: 7px 10px;
                font-size: 11px;
            }
            
            .action-btn i {
                font-size: 12px;
            }
            
            #action-title {
                font-size: 12px;
            }
        }
        
        /* å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 380px) {
            .action-btn span {
                max-width: 60px;
            }
            
            #action-buttons {
                gap: 6px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- è´µæ—çº¹ç« è£…é¥° -->
        <div class="heraldic-decoration decoration-1"></div>
        <div class="heraldic-decoration decoration-2"></div>
        
        <!-- çŠ¶æ€æ  -->
        <div id="status-bar">
            <div id="month-display">
                <i class="fas fa-calendar-alt"></i>
                <span id="current-month">ç¬¬1/12è½® â€¢ ç§‹å­£</span>
            </div>
            <div id="reputation">
                <i class="fas fa-crown"></i>
                <span id="reputation-value">å£°æœ›ï¼šè‰¯å¥½</span>
            </div>
        </div>
        
        <!-- æ¸¸æˆæ ‡é¢˜ -->
        <div id="game-header">
            <h1>âœ¨ã€Šå­çˆµå°å§çš„å©šäº‹ã€‹âœ¨</h1>
            <p>æ‰®æ¼”å®‰å¦®Â·åšæ—ï¼Œåœ¨12ä¸ªæœˆå†…é€šè¿‡å©šå§»æ‹¯æ•‘å®¶æ—é—äº§</p>
            <div class="progress-container">
                <div class="progress-bar" id="time-progress"></div>
            </div>
        </div>
        
        <!-- å¯¹è¯åŒºåŸŸ -->
        <div id="chat-area">
            <!-- å¯¹è¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- è¡ŒåŠ¨é€‰æ‹©åŒºåŸŸ - ç²¾ç®€ä¸ºä¸€è¡Œ -->
        <div id="action-area">
            <div id="action-title">
                <i class="fas fa-chess-queen"></i> æœ¬æœˆå¯é‡‡å–çš„è¡ŒåŠ¨
            </div>
            <div id="action-buttons-container">
                <div id="action-buttons">
                    <!-- è¡ŒåŠ¨æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            <div id="action-points">
                <span>è¡ŒåŠ¨ç‚¹ï¼š</span>
                <div class="action-point available"></div>
                <div class="action-point available"></div>
                <div class="action-point available"></div>
            </div>
        </div>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div id="input-area">
            <input type="text" id="user-input" placeholder="è¾“å…¥å¯¹è¯æˆ–é€‰æ‹©è¡ŒåŠ¨..." maxlength="250" autocomplete="off">
            <button id="send-btn">
                <i class="fas fa-feather-alt"></i>
            </button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        const gameState = {
            currentMonth: 1,
            totalMonths: 12,
            season: "ç§‹å­£",
            reputation: "è‰¯å¥½",
            reputationValue: 75,
            actionPoints: 3,
            maxActionPoints: 3,
            characters: {
                anne: { name: "å®‰å¦®Â·åšæ—", title: "å­çˆµå°å§" },
                system: { name: "ç³»ç»Ÿ", title: "" },
                ai: { name: "æ¸¸æˆä¸»æŒ", title: "" },
                mother: { name: "åšæ—å¤«äºº", title: "å­çˆµå¤«äºº" },
                father: { name: "åšæ—å­çˆµ", title: "" },
                maid: { name: "çå¦®", title: "è´´èº«å¥³ä»†" }
            },
            maleCharacters: [
                { 
                    id: 1, 
                    name: "ç†æŸ¥å¾·Â·æ¸©æ–¯é¡¿", 
                    title: "å…ˆç”Ÿ", 
                    emoji: "ğŸ’°", 
                    description: "25å²ï¼Œéƒ¡é‡Œæœ€å¯Œæœ‰çš„ç»…å£«ï¼Œåæ‹¥å¸¦æ„å¤§åˆ©å¼èŠ±å›­çš„å±±æ™¯å®…é‚¸",
                    color: "#d4af37",
                    status: "æœªæ¥è§¦"
                },
                { 
                    id: 2, 
                    name: "çˆ±å¾·åÂ·ç§‘ç€", 
                    title: "çˆµå£«", 
                    emoji: "âš”ï¸", 
                    description: "24å²ï¼Œæˆ˜æ–—è‹±é›„ï¼Œå‡­æˆ˜åŠŸå—å°çˆµå£«ï¼Œé¢†æ”¿åºœå¹´é‡‘åº¦æ—¥",
                    color: "#8b7355",
                    status: "æœªæ¥è§¦"
                },
                { 
                    id: 3, 
                    name: "æŸ¥ç†Â·éœåå¾·", 
                    title: "å‹‹çˆµ", 
                    emoji: "ğŸ°", 
                    description: "21å²ï¼Œä¼¯çˆµä¹‹å­ï¼Œæœªæ¥çš„ä¼¯çˆµç»§æ‰¿äººï¼Œæ¸©æ³‰ç¤¾äº¤å­£éšçˆ¶æ¯åˆ°è®¿",
                    color: "#c9b29a",
                    status: "æœªæ¥è§¦"
                },
                { 
                    id: 4, 
                    name: "å¡ç¼ªå°”Â·æ ¼æ—", 
                    title: "å…ˆç”Ÿ", 
                    emoji: "ğŸŒ¾", 
                    description: "19å²ï¼Œæœ¬åœ°ä¹¡ç»…é•¿å­ï¼ŒåŠ¡å®å¯é çš„å†œåœºç®¡ç†è€…",
                    color: "#7d9c6d",
                    status: "æœªæ¥è§¦"
                },
                { 
                    id: 5, 
                    name: "å¨å»‰Â·å¡ç‰¹", 
                    title: "å…ˆç”Ÿ", 
                    emoji: "ğŸ“œ", 
                    description: "20å²ï¼Œä»ä¼¦æ•¦æ¥çš„æ–°é”å¾‹å¸ˆï¼Œæ€ç»´æ•æ·ã€è°ˆåé£è¶£",
                    color: "#6d8b9c",
                    status: "æœªæ¥è§¦"
                },
                { 
                    id: 6, 
                    name: "ä¹”æ²»Â·å¥¥æ–¯æœ¬", 
                    title: "ç”·çˆµ", 
                    emoji: "ğŸ•¯ï¸", 
                    description: "23å²ï¼Œå¹´è½»ç”·çˆµï¼Œç»§æ‰¿çˆµä½ä¸åº„å›­ï¼Œä¸æ¯äº²ç›¸ä¾ä¸ºå‘½",
                    color: "#9c6d8b",
                    status: "æœªæ¥è§¦"
                }
            ],
            clues: [],
            relationships: {},
            currentScene: "church",
            availableActions: [
                { 
                    id: "social", 
                    name: "ç¤¾äº¤çª¥æ¢ ğŸ‰", 
                    icon: "fa-glass-cheers", 
                    description: "å‚åŠ èˆä¼šæˆ–èŒ¶ä¼šï¼Œæ”¶é›†å…³äºç»…å£«ä»¬çš„åŠé—´ä¼ è¨€å’Œç¤¾äº¤è¯„ä»·",
                    cost: 1,
                    shortName: "ç¤¾äº¤"
                },
                { 
                    id: "visit", 
                    name: "ç§ä¸‹æ‹œè®¿ ğŸšª", 
                    icon: "fa-home", 
                    description: "å‰å¾€ç›®æ ‡ç»…å£«çš„ä½å¤„è¿›è¡Œæ­£å¼æ‹œè®¿ï¼Œè§‚å¯Ÿç”Ÿæ´»ç»†èŠ‚ä¸çœŸå®çŠ¶å†µ",
                    cost: 1,
                    shortName: "æ‹œè®¿"
                },
                { 
                    id: "letter", 
                    name: "ä¿¡ä»¶è¿½é—® âœ‰ï¸", 
                    icon: "fa-envelope", 
                    description: "é€šè¿‡ä¹¦ä¿¡å¾€æ¥äº†è§£ç»…å£«çš„å“å‘³ã€å­¦è¯†ä¸çœŸå®æ„å›¾",
                    cost: 1,
                    shortName: "ä¿¡ä»¶"
                },
                { 
                    id: "mother", 
                    name: "æ¯äº²æ‰“å¬ ğŸ—£ï¸", 
                    icon: "fa-female", 
                    description: "è¯·æ¯äº²åŠ¨ç”¨æ—§äººè„‰ç½‘ç»œï¼Œäº†è§£å¯¹æ–¹å®¶æ—çš„é™ˆå¹´æ—§äº‹ä¸çœŸå®èƒŒæ™¯",
                    cost: 1,
                    shortName: "æ¯äº²"
                },
                { 
                    id: "maid", 
                    name: "å¥³ä»†ä¾¦æŸ¥ ğŸ‘©ğŸ»", 
                    icon: "fa-user-secret", 
                    description: "æ´¾é£è´´èº«å¥³ä»†å»å¯¹æ–¹å®…é‚¸ä¸ä»†äººäº¤æµï¼Œè·å–æœ€çœŸå®çš„å†…éƒ¨ä¿¡æ¯",
                    cost: 1,
                    shortName: "å¥³ä»†"
                },
                { 
                    id: "chat", 
                    name: "è‡ªç”±äº¤è°ˆ ğŸ’¬", 
                    icon: "fa-comments", 
                    description: "ä¸å½“å‰åœºæ™¯ä¸­çš„è§’è‰²è¿›è¡Œè‡ªç”±å¯¹è¯ï¼Œå»ºç«‹å…³ç³»æˆ–è·å–ä¿¡æ¯",
                    cost: 0,
                    shortName: "äº¤è°ˆ"
                }
            ],
            usedDialogue: new Set(),
            usedEvents: new Set(),
            sceneHistory: [],
            isAIResponding: false,
            messageQueue: [],
            processedKeywords: new Set()
        };

        // è´µæ—é£æ ¼æ¼‚æµ®å…ƒç´ 
        function createFloatingElements() {
            const elementTypes = [
                { emoji: "âšœï¸", size: 24 },
                { emoji: "ğŸ‘‘", size: 28 },
                { emoji: "ğŸ’", size: 22 },
                { emoji: "ğŸ°", size: 26 },
                { emoji: "ğŸ­", size: 24 }
            ];
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const element = document.createElement('div');
                    element.className = 'floating-element';
                    element.textContent = elementTypes[Math.floor(Math.random() * elementTypes.length)].emoji;
                    element.style.fontSize = `${18 + Math.random() * 12}px`;
                    element.style.left = `${Math.random() * 100}%`;
                    
                    const duration = 20 + Math.random() * 25;
                    const delay = Math.random() * 5;
                    element.style.animation = `floatElement ${duration}s linear ${delay}s infinite`;
                    
                    document.getElementById('game-container').appendChild(element);
                }, i * 300);
            }
        }

        // é˜²é‡å¤å¯¹è¯ç³»ç»Ÿ
        function isDialogueUsed(dialogueKey) {
            return gameState.usedDialogue.has(dialogueKey);
        }

        function markDialogueUsed(dialogueKey) {
            gameState.usedDialogue.add(dialogueKey);
            if (gameState.usedDialogue.size > 100) {
                const firstKey = Array.from(gameState.usedDialogue)[0];
                gameState.usedDialogue.delete(firstKey);
            }
        }

        // æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†
        function processMessageQueue() {
            if (gameState.messageQueue.length > 0 && !gameState.isAIResponding) {
                const message = gameState.messageQueue.shift();
                createMessage(message.sender, message.content, message.type, message.options);
                
                if (gameState.messageQueue.length > 0) {
                    setTimeout(processMessageQueue, 800);
                }
            }
        }

        // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
        function createMessage(sender, message, type = "ai", options = {}) {
            const chatArea = document.getElementById('chat-area');
            
            if (type === "ai" && gameState.isAIResponding) {
                gameState.messageQueue.push({ sender, content: message, type, options });
                return;
            }
            
            if (type === "ai") gameState.isAIResponding = true;
            
            const messageDiv = document.createElement('div');
            
            let messageClass = "ai-message";
            let senderName = sender;
            let avatarClass = "avatar-cat-black";
            let displayName = sender;
            
            if (type === "user") {
                messageClass = "user-message";
                avatarClass = "avatar-anne";
                displayName = "å®‰å¦®Â·åšæ—";
            } else if (type === "system") {
                messageClass = "system-message";
                senderName = "ç³»ç»Ÿ";
                displayName = "ç³»ç»Ÿé€šçŸ¥";
            } else if (type === "mother") {
                messageClass = "ai-message";
                avatarClass = "avatar-cat-pink";
                displayName = "åšæ—å¤«äºº";
            } else if (type === "maid") {
                messageClass = "ai-message";
                displayName = "çå¦®";
            }
            
            const decoratedMessage = decorateMessage(message, options.preventDecoration);
            const dialogueKey = `${type}_${decoratedMessage.substring(0, 50)}`;
            
            if (isDialogueUsed(dialogueKey) && type !== "user") {
                const variantMessage = generateDialogueVariant(decoratedMessage, type);
                messageDiv.className = `message ${messageClass}`;
                messageDiv.innerHTML = createMessageHTML(displayName, variantMessage, avatarClass, type);
                markDialogueUsed(`${type}_${variantMessage.substring(0, 50)}`);
            } else {
                messageDiv.className = `message ${messageClass}`;
                messageDiv.innerHTML = createMessageHTML(displayName, decoratedMessage, avatarClass, type);
                markDialogueUsed(dialogueKey);
            }
            
            chatArea.appendChild(messageDiv);
            
            setTimeout(() => {
                chatArea.scrollTo({
                    top: chatArea.scrollHeight,
                    behavior: 'smooth'
                });
            }, 50);
            
            if (type === "ai") {
                setTimeout(() => {
                    gameState.isAIResponding = false;
                    processMessageQueue();
                }, options.delay || 1000);
            }
            
            return messageDiv;
        }

        // åˆ›å»ºæ¶ˆæ¯HTML
        function createMessageHTML(senderName, message, avatarClass, type) {
            const avatarSvg = type === "user" ? 
                `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36"><circle cx="18" cy="18" r="16" fill="#d4af37"/><text x="18" y="24" font-size="16" text-anchor="middle" fill="#1a120b" font-weight="bold">A</text></svg>` :
                type === "system" ?
                `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36"><circle cx="18" cy="18" r="16" fill="#8b7355"/><text x="18" y="24" font-size="16" text-anchor="middle" fill="#f5e9d9" font-weight="bold">S</text></svg>` :
                `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36"><circle cx="18" cy="18" r="16" fill="#5d4037"/><text x="18" y="24" font-size="16" text-anchor="middle" fill="#f5e9d9" font-weight="bold">G</text></svg>`;
            
            return `
                <div class="message-sender">
                    ${type !== "system" ? 
                        `<img src="data:image/svg+xml;utf8,${encodeURIComponent(avatarSvg)}" class="avatar ${avatarClass}" />` 
                        : ''
                    }
                    <span>${senderName}</span>
                </div>
                <div class="message-content">${message}</div>
            `;
        }

        // å¯¹è¯å˜ä½“ç”Ÿæˆå™¨
        function generateDialogueVariant(originalMessage, type) {
            const variants = {
                ai: [
                    (msg) => msg.replace("ã€‚", "å‘¢ã€‚").replace("ï¼", "å“¦ï¼"),
                    (msg) => msg.replace("ä½ å¯ä»¥", "æˆ–è®¸ä½ å¯ä»¥è€ƒè™‘").replace("åº”è¯¥", "ä¸å¦¨"),
                    (msg) => msg + " å½“ç„¶äº†ï¼Œè¿™ä»…ä»…æ˜¯æˆ‘çš„å»ºè®®ã€‚",
                    (msg) => "è¯´åˆ°è¿™ä¸ªï¼Œ" + msg.toLowerCase(),
                ],
                mother: [
                    (msg) => msg.replace("ã€‚", "ï¼Œäº²çˆ±çš„ã€‚").replace("ï¼", "å‘¢ï¼"),
                    (msg) => "æˆ‘çš„å­©å­ï¼Œ" + msg,
                    (msg) => msg + " è¿™æ˜¯å¦ˆå¦ˆçš„ç»éªŒä¹‹è°ˆã€‚",
                ],
                maid: [
                    (msg) => msg.replace("å°å§", "å°å§å‘€").replace("ã€‚", "å‘¢ã€‚"),
                    (msg) => "æˆ‘å¬è¯´" + msg.toLowerCase(),
                    (msg) => msg + " è¿™æ˜¯å¨å¨˜æ‚„æ‚„å‘Šè¯‰æˆ‘çš„ã€‚",
                ]
            };
            
            const typeVariants = variants[type] || variants.ai;
            const variantFunc = typeVariants[Math.floor(Math.random() * typeVariants.length)];
            return variantFunc(originalMessage);
        }

        // è£…é¥°æ¶ˆæ¯å†…å®¹
        function decorateMessage(message, preventDecoration = false) {
            if (preventDecoration) return message;
            
            const decorationMap = [
                { pattern: /æ•™å ‚/gi, replacement: 'â›ª' },
                { pattern: /èˆä¼š/gi, replacement: 'ğŸ’ƒ' },
                { pattern: /å©šå§»|ç»“å©š/gi, replacement: 'ğŸ’' },
                { pattern: /åº„å›­/gi, replacement: 'ğŸ°' },
                { pattern: /çˆ¶äº²/gi, replacement: 'ğŸ‘¨â€ğŸ¦³' },
                { pattern: /æ¯äº²/gi, replacement: 'ğŸ‘©â€ğŸ¦³' },
                { pattern: /å¥³ä»†/gi, replacement: 'ğŸ‘©ğŸ»' },
                { pattern: /å¾‹å¸ˆ/gi, replacement: 'âš–ï¸' },
                { pattern: /çˆµä½|è´µæ—/gi, replacement: 'ğŸ‘‘' },
                { pattern: /è´¢å¯Œ|é‡‘é’±|å¯Œæœ‰/gi, replacement: 'ğŸ’°' },
                { pattern: /ç§˜å¯†/gi, replacement: 'ğŸ¤«' },
                { pattern: /çº¿ç´¢/gi, replacement: 'ğŸ”' },
                { pattern: /å±æœº/gi, replacement: 'âš ï¸' },
                { pattern: /æˆåŠŸ/gi, replacement: 'ğŸ‰' },
                { pattern: /å¤±è´¥/gi, replacement: 'ğŸ˜¢' },
                { pattern: /æ·‘å¥³/gi, replacement: 'ğŸ‘¸' },
                { pattern: /ç»…å£«/gi, replacement: 'ğŸ©' },
                { pattern: /å†›é˜Ÿ|å†›äºº/gi, replacement: 'âš”ï¸' },
                { pattern: /å†œåœº|å†œä¸š/gi, replacement: 'ğŸŒ¾' },
                { pattern: /ä¿¡ä»¶|ä¹¦ä¿¡/gi, replacement: 'âœ‰ï¸' },
                { pattern: /èœ¡çƒ›|çƒ›å…‰/gi, replacement: 'ğŸ•¯ï¸' },
                { pattern: /èŠ±å›­/gi, replacement: 'ğŸŒ¹' },
                { pattern: /é©¬è½¦/gi, replacement: 'ğŸš—' },
                { pattern: /èŒ¶ä¼š/gi, replacement: 'ğŸµ' },
                { pattern: /è‘¡è„é…’/gi, replacement: 'ğŸ·' },
                { pattern: /æ—¶é’Ÿ|æ—¶é—´/gi, replacement: 'â³' },
            ];
            
            let decorated = message;
            decorationMap.forEach(item => {
                decorated = decorated.replace(item.pattern, match => `${item.replacement}${match}`);
            });
            
            const nobleSuffixes = [
                '', '', '',
                'ï¼Œæˆ‘äº²çˆ±çš„ã€‚',
                'ï¼Œè¯šå¦‚æ‰€è¨€ã€‚',
                'ï¼Œé˜ä¸‹æ˜é‰´ã€‚',
                'ï¼Œæ‚¨æ„ä¸‹å¦‚ä½•ï¼Ÿ',
                'ï¼Œæœ›æ‚¨æ·±æ€ã€‚'
            ];
            
            if (Math.random() > 0.7 && decorated.endsWith('ã€‚')) {
                decorated = decorated.slice(0, -1) + nobleSuffixes[Math.floor(Math.random() * nobleSuffixes.length)];
            }
            
            return decorated;
        }

        // æ›´æ–°è¡ŒåŠ¨æŒ‰é’®ï¼ˆç²¾ç®€ä¸ºä¸€è¡Œï¼‰
        function updateActionButtons() {
            const actionButtons = document.getElementById('action-buttons');
            actionButtons.innerHTML = '';
            
            gameState.availableActions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'action-btn';
                button.innerHTML = `<i class="fas ${action.icon}"></i> <span>${action.shortName || action.name}</span>`;
                button.title = action.description;
                button.dataset.actionId = action.id;
                
                // æ·»åŠ è¡ŒåŠ¨ç‚¹é™åˆ¶è§†è§‰æç¤º
                if (gameState.actionPoints < action.cost) {
                    button.style.opacity = '0.6';
                    button.style.cursor = 'not-allowed';
                    button.title = `è¡ŒåŠ¨ç‚¹ä¸è¶³ï¼ˆéœ€è¦${action.cost}ç‚¹ï¼‰`;
                } else {
                    button.addEventListener('click', () => {
                        handleAction(action.id);
                    });
                }
                
                actionButtons.appendChild(button);
            });
            
            // æ›´æ–°è¡ŒåŠ¨ç‚¹æ˜¾ç¤º
            updateActionPointsDisplay();
        }

        // æ›´æ–°è¡ŒåŠ¨ç‚¹æ˜¾ç¤º
        function updateActionPointsDisplay() {
            const actionPointsContainer = document.getElementById('action-points');
            const pointsSpan = actionPointsContainer.querySelector('span');
            pointsSpan.textContent = `è¡ŒåŠ¨ç‚¹ï¼š${gameState.actionPoints}/${gameState.maxActionPoints}`;
            
            // æ›´æ–°è¡ŒåŠ¨ç‚¹åœ†åœˆ
            const pointElements = actionPointsContainer.querySelectorAll('.action-point');
            pointElements.forEach((point, index) => {
                point.className = 'action-point';
                if (index < gameState.actionPoints) {
                    point.classList.add('available');
                } else {
                    point.classList.add('used');
                }
            });
        }

        // å¤„ç†è¡ŒåŠ¨é€‰æ‹©
        function handleAction(actionId) {
            const userInput = document.getElementById('user-input');
            
            // æ£€æŸ¥è¡ŒåŠ¨ç‚¹
            const action = gameState.availableActions.find(a => a.id === actionId);
            if (action.cost > gameState.actionPoints) {
                createMessage("ç³»ç»Ÿ", "âš ï¸ è¡ŒåŠ¨ç‚¹ä¸è¶³ï¼æœ¬æœˆä½ å·²æ¶ˆè€—äº†å¤ªå¤šç²¾åŠ›ï¼Œéœ€è¦ç­‰å¾…ä¸‹ä¸ªæœˆæ¢å¤ã€‚", "system");
                return;
            }
            
            // æ¶ˆè€—è¡ŒåŠ¨ç‚¹
            if (action.cost > 0) {
                gameState.actionPoints -= action.cost;
                updateActionPointsDisplay();
                updateActionButtons(); // æ›´æ–°æŒ‰é’®çŠ¶æ€
            }
            
            // æ ¹æ®è¡ŒåŠ¨ç±»å‹å¡«å……è¾“å…¥æ¡†
            switch(actionId) {
                case 'social':
                    userInput.value = "æˆ‘æƒ³å‚åŠ æœ¬æœˆçš„ç¤¾äº¤æ´»åŠ¨ï¼Œæ”¶é›†å…³äºç»…å£«ä»¬çš„æœ€æ–°ä¿¡æ¯ã€‚";
                    break;
                case 'visit':
                    userInput.value = "æˆ‘æ‰“ç®—å¯¹æŸä½ç»…å£«è¿›è¡Œä¸€æ¬¡æ­£å¼çš„æ‹œè®¿ï¼Œè§‚å¯Ÿä»–çš„çœŸå®ç”Ÿæ´»ç¯å¢ƒã€‚";
                    break;
                case 'letter':
                    userInput.value = "è¯·å¸®æˆ‘å‡†å¤‡ä¿¡çº¸å’Œå¢¨æ°´ï¼Œæˆ‘æƒ³ç»™æŸä½ç»…å£«å†™ä¸€å°ä¿¡ã€‚";
                    break;
                case 'mother':
                    userInput.value = "æ¯äº²ï¼Œæ‚¨èƒ½è¿ç”¨æ‚¨çš„äººè„‰ï¼Œå¸®æˆ‘æ‰“å¬ä¸€ä¸‹é‚£å‡ ä½ç»…å£«çš„å®¶åº­èƒŒæ™¯å—ï¼Ÿ";
                    break;
                case 'maid':
                    userInput.value = "çå¦®ï¼Œæˆ‘éœ€è¦ä½ å¸®æˆ‘æ‚„æ‚„æ‰“å¬ä¸€äº›æ¶ˆæ¯...";
                    break;
                case 'chat':
                    userInput.value = "";
                    userInput.placeholder = "è¾“å…¥ä½ æƒ³è¯´çš„è¯æˆ–é—®é¢˜...";
                    break;
            }
            
            userInput.focus();
            
            // æ·»åŠ è¡ŒåŠ¨ç¡®è®¤
            setTimeout(() => {
                createMessage("ç³»ç»Ÿ", `ğŸ“ å·²é€‰æ‹©è¡ŒåŠ¨ï¼š${action.name}`, "system", { preventDecoration: true });
            }, 300);
        }

        // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            document.getElementById('current-month').textContent = 
                `ç¬¬${gameState.currentMonth}/${gameState.totalMonths}è½® â€¢ ${gameState.season}`;
            document.getElementById('reputation-value').textContent = 
                `å£°æœ›ï¼š${gameState.reputation}`;
            
            // æ›´æ–°æ—¶é—´è¿›åº¦æ¡
            const progressPercent = (gameState.currentMonth / gameState.totalMonths) * 100;
            document.getElementById('time-progress').style.width = `${progressPercent}%`;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆ›å»ºè´µæ—é£æ ¼è£…é¥°
            createFloatingElements();
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();
            
            // æ›´æ–°è¡ŒåŠ¨æŒ‰é’®
            updateActionButtons();
            
            // æ·»åŠ åˆå§‹æ¸¸æˆæ¶ˆæ¯
            createMessage("ç³»ç»Ÿ", 
                "âœ¨ã€Šå­çˆµå°å§çš„å©šäº‹ã€‹â€”â€” è´µæ—å©šæ‹æ¸¸æˆå¼€å§‹ï¼âœ¨\n" +
                "ğŸ° èƒŒæ™¯ï¼šæ‘„æ”¿æ—¶æœŸï¼Œè‹±æ ¼å…°ä¹¡æ‘", 
                "system"
            );
            
            setTimeout(() => {
                createMessage("ç³»ç»Ÿ",
                    "ğŸ“œ ä½ æ‰®æ¼”å®‰å¦®Â·åšæ—ï¼Œ18å²çš„å­çˆµç‹¬ç”Ÿå¥³ã€‚è¡¨é¢ä¸Šï¼Œä½ æ˜¯éƒ¡é‡Œå°æœ‰åæ°”çš„æ·‘å¥³ï¼Œä¸¾æ­¢ä¼˜é›…ã€ä»ªæ€ä¸‡æ–¹ã€‚\n" +
                    "ğŸ’” ä½†å®é™…ä¸Šï¼Œä½ çš„å®¶æ—æ¿’ä¸´ç ´äº§ï¼Œåº„å›­ä½ƒç§Ÿæ‹–æ¬ ã€ç¥–ä¼ çå®æš—ä¸­å…¸å½“...è‹¥12ä¸ªæœˆå†…æœªèƒ½é€šè¿‡è”å§»ä¿ä½å®¶äº§ï¼Œåšæ—å®¶çš„äº§ä¸šå°†è¢«è¿œæ–¹äº²æˆšåå¹¶ã€‚",
                    "system"
                );
            }, 800);
            
            setTimeout(() => {
                createMessage("ç³»ç»Ÿ",
                    "â³ æ—¶é—´ç´§è¿«ï¼šä½ åªæœ‰12ä¸ªæœˆï¼ˆ12è½®æ¸¸æˆï¼‰çš„æ—¶é—´å¯»æ‰¾åˆé€‚çš„ç»“å©šå¯¹è±¡ã€‚\n" +
                    "ğŸ¯ ç›®æ ‡ï¼šé€šè¿‡å©šå§»æ‹¯æ•‘å®¶æ—é—äº§ï¼ŒåŒæ—¶å°½å¯èƒ½æ‰¾åˆ°çœŸæŒšçš„æ„Ÿæƒ…ã€‚",
                    "system"
                );
            }, 1600);
            
            // åˆå§‹åœºæ™¯ï¼šæ•™å ‚ç¤¼æ‹œæ—¥
            setTimeout(() => {
                showInitialScene();
            }, 2500);
        }

        // æ˜¾ç¤ºåˆå§‹åœºæ™¯
        function showInitialScene() {
            gameState.currentScene = "church";
            gameState.sceneHistory.push("church");
            
            createMessage("æ¸¸æˆä¸»æŒ", 
                "â›ª **åœºæ™¯ï¼šåœ£ç›ä¸½æ•™å ‚ç¤¼æ‹œæ—¥**\n\n" +
                "æ™¨å…‰é€è¿‡å“¥ç‰¹å¼å½©è‰²ç»ç’ƒçª—ï¼Œå°†çº¢ã€è“ã€é‡‘è‰²çš„å…‰å½±æ´’åœ¨å¤è€çš„çŸ³ç Œåœ°é¢ä¸Šã€‚ç©ºæ°”ä¸­å¼¥æ¼«ç€æ—§æ©¡æœ¨æ¤…ã€èœ‚èœ¡èœ¡çƒ›å’Œå¹²ç‡¥è–°è¡£è‰çš„æ··åˆæ°”æ¯ï¼Œè¿™æ˜¯è‹±æ ¼å…°ä¹¡æ‘æ•™å ‚ç‰¹æœ‰çš„å‘³é“ã€‚\n\n" +
                "ä½ ä¸çˆ¶æ¯ä¸€åŒååœ¨åšæ—å®¶æ—ä¸‰ä»£çš„ä¸“ç”¨é•¿æ¤…ä¸Šâ€”â€”ç¬¬äº”æ’å·¦ä¾§ï¼Œç¦»åœ£å›ä¸è¿œä¸è¿‘ï¼Œæ°å¦‚å…¶åˆ†åœ°æ˜¾ç¤ºäº†å­çˆµå®¶æ—åœ¨æ•™åŒºä¸­çš„åœ°ä½ã€‚ä½ èƒ½æ„Ÿå—åˆ°èº«åæŠ•æ¥çš„å„ç§ç›®å…‰ï¼šå¹´è½»æ·‘å¥³ä»¬å¥½å¥‡çš„çª¥è§†ã€æ¯äº²ä»¬è¯„åˆ¤çš„æ‰“é‡ã€è¿˜æœ‰å‡ ä½è€ç»…å£«åŒæƒ…çš„ä½è¯­ã€‚\n\n" +
                "æ¯äº²è½»è½»ç¢°äº†ç¢°ä½ çš„æ‰‹è‡‚ï¼Œå¥¹æˆ´ç€è•¾ä¸æ‰‹å¥—çš„æ‰‹æŒ‡å†°å‡‰ï¼šã€å®‰å¦®ï¼ŒèƒŒæŒºç›´ï¼Œä¸‹å·´å¾®æ”¶ã€‚è®°ä½ï¼Œä»Šå¤©å…¨é•‡çš„ä½“é¢äººå®¶éƒ½ä¼šæ¥ï¼Œç‰¹åˆ«æ˜¯é‚£å‡ ä½å•èº«ç»…å£«...ã€å¥¹åœé¡¿äº†ä¸€ä¸‹ï¼Œå£°éŸ³å‹å¾—æ›´ä½ï¼Œã€...è®°ä½æˆ‘ä»¬çš„å¤„å¢ƒï¼Œæ¯ä¸€ä¸ªç»†èŠ‚éƒ½å¯èƒ½å†³å®šå®¶æ—çš„å‘½è¿ã€‚ã€\n\n" +
                "çˆ¶äº²åœ¨ä¸€æ—æ²‰é»˜åœ°ç¿»ç€ã€Šå…¬ç¥·ä¹¦ã€‹ï¼Œä»–çš„æŒ‡èŠ‚å› ç”¨åŠ›è€Œå‘ç™½ã€‚ä½ çŸ¥é“ä»–åœ¨æƒ³ä»€ä¹ˆâ€”â€”æŠµæŠ¼ç»™ä¼¦æ•¦é“¶è¡Œå®¶çš„å®¶æ—å¾½ç« ï¼Œè¿˜æœ‰ä¸‹å­£åº¦å°±åˆ°æœŸçš„ä½ƒç§Ÿã€‚",
                "ai"
            );
            
            setTimeout(() => {
                createMessage("æ¸¸æˆä¸»æŒ",
                    "ğŸ•°ï¸ ç¤¼æ‹œç»ˆäºç»“æŸï¼Œç®¡é£ç´çš„æœ€åä¸€ä¸ªéŸ³ç¬¦åœ¨æ‹±é¡¶ä¸‹æ¶ˆæ•£ã€‚äººä»¬åœ¨æ•™å ‚åº­é™¢é‡Œå±•å¼€å‘¨æ—¥çš„ç¤¾äº¤ä»ªå¼ï¼Œé˜³å…‰ç©¿è¿‡æ¦†æ ‘å¶ï¼Œåœ¨åœ°é¢æŠ•ä¸‹æ–‘é©³å…‰å½±ã€‚\n\n" +
                    "ä½ æ·±å¸ä¸€å£æ°”ï¼Œè°ƒæ•´å¥½è£™æ‘†ï¼Œéšç€çˆ¶æ¯èµ°å‡ºæ•™å ‚ã€‚åº­é™¢é‡Œï¼Œå…­ä½æœªå©šç»…å£«å„è‡ªå½¢æˆäº†å°å°çš„ç¤¾äº¤åœˆã€‚ä»–ä»¬éƒ½å°†æ˜¯ä½ æœªæ¥12ä¸ªæœˆä¸­æ½œåœ¨çš„ç»“å©šå¯¹è±¡ï¼š",
                    "ai"
                );
            }, 1200);
            
            // ä»‹ç»å…­ä½ç”·æ€§è§’è‰²
            setTimeout(() => {
                const characterDescriptions = [
                    "ğŸ’° **ç†æŸ¥å¾·Â·æ¸©æ–¯é¡¿å…ˆç”Ÿ**ç«™åœ¨å–·æ³‰æ—ï¼Œç©¿ç€å‰ªè£å®Œç¾çš„æ·±è“è‰²åŒæ’æ‰£å¤–å¥—ï¼Œé˜³å…‰ç…§åœ¨ä»–é‡‘è‰²çš„æ€€è¡¨é“¾ä¸Šé—ªçƒå¾®å…‰ã€‚",
                    "âš”ï¸ **çˆ±å¾·åÂ·ç§‘ç€çˆµå£«**èº«å§¿ç¬”æŒºåœ°ç«™åœ¨è€æ¦†æ ‘ä¸‹ï¼Œå·¦è„¸é¢Šæœ‰ä¸€é“æ·¡ç™½çš„ç–¤ç—•ï¼Œä¸ºè‹±ä¿Šçš„é¢å®¹å¹³æ·»å‡ åˆ†å†›äººçš„å¨ä¸¥ã€‚",
                    "ğŸ° **æŸ¥ç†Â·éœåå¾·å‹‹çˆµ**è¢«ä¸€ç¾¤ä»°æ…•è€…å›´ç€ï¼Œä»–é‡‘è‰²çš„å¤´å‘åœ¨é˜³å…‰ä¸‹å®›å¦‚ç‹å† ï¼Œç©¿ç€ä¼¦æ•¦æœ€æ—¶é«¦çš„æµ…ç°è‰²æ™¨ç¤¼æœã€‚",
                    "ğŸŒ¾ **å¡ç¼ªå°”Â·æ ¼æ—å…ˆç”Ÿ**æ­£ä¸è‡ªå®¶å¦¹å¦¹èŠå¤©ï¼Œçªç„¶çˆ†å‘çš„ç¬‘å£°çˆ½æœ—çœŸè¯šï¼Œä»–çš„é´å­ä¸Šæ²¾ç€æ–°é²œçº¢åœŸï¼Œåœ¨ä¸€ä¼—å…‰é²œç»…å£«ä¸­æ˜¾å¾—æ ¼å¤–æœ´å®ã€‚",
                    "ğŸ“œ **å¨å»‰Â·å¡ç‰¹å…ˆç”Ÿ**å€šåœ¨å»ŠæŸ±è¾¹ï¼Œæ­£ä¸è€æ³•å®˜è®¨è®ºæ³•å¾‹é—®é¢˜ï¼Œè¯­é€Ÿå¿«è€Œæ¸…æ™°ï¼Œæ˜¾ç¤ºå‡ºå¾‹å¸ˆçš„ä¸“ä¸šç´ å…»ã€‚",
                    "ğŸ•¯ï¸ **ä¹”æ²»Â·å¥¥æ–¯æœ¬ç”·çˆµ**ç‹¬è‡ªç«™åœ¨æ•™å ‚é˜´å½±æœ€æ·±çš„è§’è½ï¼Œå‡ ä¹ä¸å“¥ç‰¹å¼çŸ³æŸ±èä¸ºä¸€ä½“ï¼ŒæŒ‡å°–è½»è½»æ‘©æŒ²ç€ä¸€æœ¬è¾¹ç¼˜ç£¨æŸçš„çš®é¢åœ£ç»ã€‚"
                ];
                
                characterDescriptions.forEach((desc, index) => {
                    setTimeout(() => {
                        createMessage("æ¸¸æˆä¸»æŒ", desc, "ai");
                    }, index * 600);
                });
            }, 2000);
            
            // æœ€åçš„é€‰æ‹©æç¤º
            setTimeout(() => {
                createMessage("æ¸¸æˆä¸»æŒ",
                    "\nğŸ‚ ç§‹é£æ‹‚è¿‡åº­é™¢ï¼Œå·èµ·å‡ ç‰‡é‡‘é»„è½å¶ï¼Œå¸¦æ¥è¿œå¤„è‹¹æœå›­çš„é¦™æ°”ã€‚å‡ ä½æ·‘å¥³æ­£ç›¸çº¦ä¸‹å‘¨çš„åˆºç»£èšä¼šã€‚\n\n" +
                    "æ¯äº²è½»æ¨ä½ ï¼šã€è¯¥å»æ‰“æ‹›å‘¼äº†ï¼Œå®‰å¦®ã€‚è®°ä½ï¼Œå¾®ç¬‘è¦çŸœæŒï¼Œè°ˆè¯è¦å¾—ä½“ã€‚ã€\n\n" +
                    "**ç°åœ¨ï¼Œä½ å†³å®šå¦‚ä½•å¼€å§‹ä½ çš„è®¡åˆ’ï¼Ÿ**\n" +
                    "ä½ å¯ä»¥ä½¿ç”¨ä¸Šæ–¹çš„è¡ŒåŠ¨æŒ‰é’®ï¼Œæˆ–ç›´æ¥è¾“å…¥ä½ æƒ³è¯´çš„è¯ã€‚",
                    "ai"
                );
            }, 5600);
        }

        // å¤„ç†ç”¨æˆ·å‘é€æ¶ˆæ¯
        async function handleUserMessage() {
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();
            
            if (message === '') return;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            createMessage("å®‰å¦®Â·åšæ—", message, "user");
            
            // å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶ç”ŸæˆAIå“åº”
            await generateAIResponse(message);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            userInput.value = '';
            userInput.placeholder = "è¾“å…¥å¯¹è¯æˆ–é€‰æ‹©è¡ŒåŠ¨...";
        }

        // ç”ŸæˆAIå“åº”
        async function generateAIResponse(userMessage) {
            try {
                const messageHash = userMessage.substring(0, 30);
                if (gameState.processedKeywords.has(messageHash)) {
                    userMessage = userMessage + "?";
                }
                gameState.processedKeywords.add(messageHash);
                
                if (gameState.processedKeywords.size > 50) {
                    const firstKey = Array.from(gameState.processedKeywords)[0];
                    gameState.processedKeywords.delete(firstKey);
                }
                
                // æ˜¾ç¤ºAIæ­£åœ¨è¾“å…¥çš„æŒ‡ç¤º
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'message ai-message';
                typingIndicator.innerHTML = `
                    <div class="message-sender">
                        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><circle cx='18' cy='18' r='16' fill='%235d4037'/><text x='18' y='24' font-size='16' text-anchor='middle' fill='%23f5e9d9' font-weight='bold'>G</text></svg>" class="avatar avatar-cat-black" />
                        <span>æ¸¸æˆä¸»æŒ</span>
                        <div class="typing-indicator">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </div>
                    </div>
                `;
                document.getElementById('chat-area').appendChild(typingIndicator);
                document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
                
                // æ¨¡æ‹ŸAIæ€è€ƒæ—¶é—´
                await new Promise(resolve => setTimeout(resolve, 1200 + Math.random() * 1000));
                
                // ç§»é™¤è¾“å…¥æŒ‡ç¤º
                typingIndicator.remove();
                
                // ç”Ÿæˆå“åº”
                let response = "";
                let responseType = "ai";
                
                const lowerMessage = userMessage.toLowerCase();
                
                // ç¤¾äº¤æ´»åŠ¨ç›¸å…³
                if (lowerMessage.includes("èˆä¼š") || lowerMessage.includes("èŒ¶ä¼š") || lowerMessage.includes("ç¤¾äº¤")) {
                    response = "ğŸ’ƒ **ç§‹å­£èˆä¼šé‚€è¯·**\n\næœ¬æœˆçš„ç¤¾äº¤æ—¥å†ä¸Šæœ‰å‡ åœºé‡è¦æ´»åŠ¨ï¼šæ¸©æ–¯é¡¿å®…é‚¸ç§‹å­£èˆä¼šã€ç§‘ç€çˆµå£«çš„å†›å®˜èŒ¶ä¼šã€éœåå¾·å®¶çš„ç§å¯†æ™šå®´ã€‚æ¯åœºæ´»åŠ¨éƒ½èƒ½æä¾›ä¸åŒçš„æƒ…æŠ¥ã€‚ä½ æƒ³é‡ç‚¹å…³æ³¨å“ªä¸€åœºï¼Ÿ";
                } 
                // æ‹œè®¿ç›¸å…³
                else if (lowerMessage.includes("æ‹œè®¿") || lowerMessage.includes("ä½å¤„") || lowerMessage.includes("è§‚å¯Ÿ")) {
                    response = "ğŸšª **æ­£å¼æ‹œè®¿è®¡åˆ’**\n\nç§ä¸‹æ‹œè®¿èƒ½è§‚å¯Ÿç»…å£«çœŸå®ç”Ÿæ´»çŠ¶å†µã€‚æ¨èå€Ÿå£ï¼šå½’è¿˜å€Ÿé˜…ä¹¦ç±ã€èµ é€è‡ªåˆ¶æœé…±ã€è¯·æ•™å›­è‰ºé—®é¢˜ã€‚ä½ æƒ³æ‹œè®¿å“ªä¸€ä½ï¼Ÿæ¯ä½ç»…å£«çš„å®¶éƒ½èƒ½è®²è¿°ä¸åŒçš„æ•…äº‹ã€‚";
                }
                // ä¹¦ä¿¡ç›¸å…³
                else if (lowerMessage.includes("ä¿¡") || lowerMessage.includes("å†™ä¿¡") || lowerMessage.includes("ä¹¦ä¿¡")) {
                    response = "âœ‰ï¸ **ä¹¦ä¿¡å¾€æ¥ç­–ç•¥**\n\nä¹¦ä¿¡æ˜¯æ·‘å¥³ä¸ç»…å£«é—´æœ€å¾—ä½“ã€æœ€å®‰å…¨çš„äº¤æµæ–¹å¼ã€‚æ¨èè¯é¢˜ï¼šæ–‡å­¦æ¢è®¨ã€å›­è‰ºäº¤æµã€æ…ˆå–„è¯¢é—®ã€éŸ³ä¹è®¨è®ºã€‚å¨å»‰Â·å¡ç‰¹å¾‹å¸ˆå¯èƒ½å›ä¿¡æœ€å¿«ï¼Œè€Œä¹”æ²»Â·å¥¥æ–¯æœ¬ç”·çˆµå¯èƒ½æ ¹æœ¬ä¸å›å¤ã€‚";
                }
                // æ¯äº²ç›¸å…³
                else if (lowerMessage.includes("å¦ˆå¦ˆ") || lowerMessage.includes("æ¯äº²") || lowerMessage.includes("æ¯äº²")) {
                    responseType = "mother";
                    response = "ğŸ‘©â€ğŸ¦³ ä½ çš„æ¯äº²æ”¾ä¸‹æ‰‹ä¸­çš„åˆºç»£ï¼Œå°†ä½ æ‹‰åˆ°å®¢å…è§’è½ï¼šã€æ¸©æ–¯é¡¿å®¶çš„è´¢å¯Œæ˜¯å®å®åœ¨åœ¨çš„ï¼Œä½†ä»–çˆ¶äº²é‚£è¾¹æœ‰ç—›é£çš„ç—…å²ã€‚ç§‘ç€çˆµå£«çš„å¹´é‡‘å¤Ÿä½“é¢ä½†æ”’ä¸ä¸‹å¤§é’±ã€‚éœåå¾·å‹‹çˆµå®¶ä¸–æœ€å¥½ï¼Œå¯ä¼¯çˆµå¤«äººè¦æ±‚æœªæ¥å„¿åª³è‡³å°‘æœ‰äº”ä¸‡è‹±é•‘å«å¦†...ã€å¥¹å¹äº†å£æ°”ï¼Œã€ä½ æƒ³å…·ä½“äº†è§£å“ªä¸€å®¶ï¼Ÿã€";
                }
                // å¥³ä»†ä¾¦æŸ¥ç›¸å…³
                else if (lowerMessage.includes("çå¦®") || lowerMessage.includes("å¥³ä»†") || lowerMessage.includes("æ‰“å¬")) {
                    responseType = "maid";
                    response = "ğŸ‘©ğŸ» ä½ çš„è´´èº«å¥³ä»†çå¦®å‹ä½å£°éŸ³ï¼šã€å°å§ï¼Œæˆ‘è¡¨å§åœ¨å¥¥æ–¯æœ¬ç”·çˆµå®¶å¸®å¨ï¼Œè¯´ç”·çˆµå¤«äººèŠ‚ä¿­å¾—è¿‡åˆ†ã€‚æ¸©æ–¯é¡¿å…ˆç”Ÿå®¶çš„å¥³ä»†è¯´ä¸œå®¶å¸¸å’Œä¼¦æ•¦å¾‹å¸ˆå¼€ä¼šåˆ°æ·±å¤œã€‚ç§‘ç€çˆµå£«çš„å‹¤åŠ¡å…µæŠ±æ€¨çˆµå£«æŠŠå¤§éƒ¨åˆ†å¹´é‡‘éƒ½å¯„ç»™äº†é˜µäº¡æˆ˜å‹çš„é—å­€...æƒ³è®©æˆ‘é‡ç‚¹æ‰“å¬å“ªå®¶ï¼Ÿã€";
                }
                // å…·ä½“è§’è‰²è¯¢é—®
                else if (lowerMessage.includes("ç†æŸ¥å¾·") || lowerMessage.includes("æ¸©æ–¯é¡¿")) {
                    response = "ğŸ’° **ç†æŸ¥å¾·Â·æ¸©æ–¯é¡¿å…ˆç”Ÿ**æ³¨æ„åˆ°ä½ çš„ç›®å…‰ï¼Œç¤¼è²Œåœ°é¢”é¦–è‡´æ„ï¼Œç¬‘å®¹å¦‚ç§‹æ—¥æš–é˜³ã€‚ä»–çš„å¤–å¥—æ˜¯ä¼¦æ•¦è¨ç»´å°”è¡—å®šåˆ¶ï¼Œæ€€è¡¨æ˜¯å®ç‘çš„æœ€æ–°æ¬¾å¼ã€‚æ®å›­ä¸é€éœ²ï¼Œä»–æœ€è¿‘åœ¨å¼•è¿›æ„å¤§åˆ©ç¨€æœ‰ç«ç‘°å“ç§ã€‚è¦ä¸Šå‰äº¤è°ˆå—ï¼Ÿ";
                }
                else if (lowerMessage.includes("çˆ±å¾·å") || lowerMessage.includes("ç§‘ç€")) {
                    response = "âš”ï¸ **çˆ±å¾·åÂ·ç§‘ç€çˆµå£«**çš„ç›®å…‰ä¸ä½ ç›¸é‡ï¼Œä»–å¾®å¾®ç‚¹å¤´â€”â€”ä¸æ˜¯ç¤¾äº¤åœºåˆé‚£ç§è½»æµ®çš„è‡´æ„ï¼Œè€Œæ˜¯å†›äººä¹‹é—´ä¸¥è‚ƒçš„è®¤å¯ã€‚ä»–çš„å‹¤åŠ¡å…µæ›¾é€éœ²ï¼Œçˆµå£«æ¯æ™šéƒ½ä¼šåœ¨ä¹¦æˆ¿é˜…è¯»å†›äº‹å†å²å’Œå“²å­¦ä¹¦ç±ã€‚è¦æ¥è¿‘è¿™æ ·ä¸€ä½ç»å†è¿‡æˆ˜äº‰çš„äººï¼Œä½ éœ€è¦è¡¨ç°å‡ºç›¸åº”çš„ç¨³é‡ã€‚";
                }
                else if (lowerMessage.includes("æŸ¥ç†") || lowerMessage.includes("éœåå¾·")) {
                    response = "ğŸ° **æŸ¥ç†Â·éœåå¾·å‹‹çˆµ**ç»“æŸäº†ä¸ä¸»æ•™çš„è°ˆè¯ï¼Œè½¬èº«æ—¶ç›®å…‰ä¸ä½ ç›¸é‡ã€‚ä»–çš„è“çœ¼ç›è¯„ä¼°æ€§åœ°æ‰«è¿‡ä½ ï¼Œä»å‘é¥°åˆ°é‹å°–ï¼Œç„¶åç»™å‡ºä¸€ä¸ªå®Œç¾çš„ç¤¾äº¤å¾®ç¬‘ã€‚éœåå¾·ä¼¯çˆµä¸€å®¶åªåœ¨æ¸©æ³‰ç¤¾äº¤å­£æ¥æ­¤ï¼Œè®¡åˆ’åœç•™ä¸‰ä¸ªæœˆï¼Œè¿™æ„å‘³ç€ä½ çš„æ—¶é—´æœ‰é™ã€‚";
                }
                else if (lowerMessage.includes("å¡ç¼ªå°”") || lowerMessage.includes("è¨å§†") || lowerMessage.includes("æ ¼æ—")) {
                    response = "ğŸŒ¾ **å¡ç¼ªå°”Â·æ ¼æ—å…ˆç”Ÿ**æ³¨æ„åˆ°ä½ åœ¨çœ‹ä»–ï¼Œæ„£äº†ä¸€ç§’ï¼Œç„¶åéœ²å‡ºé‚£ç§æœ‰ç‚¹å®³ç¾ä½†æ— æ¯”çœŸè¯šçš„ç¬‘å®¹ï¼Œç”šè‡³è½»è½»æŒ¥äº†æŒ¥æ‰‹â€”â€”è¿™åœ¨æ­£å¼ç¤¾äº¤åœºåˆç•¥æ˜¾å¤±ç¤¼ï¼Œå´ä¹Ÿæ ¼å¤–å¯çˆ±ã€‚æ ¼æ—å®¶æ˜¯æœ¬åœ°æœ€å¤§çš„ç²®é£Ÿä¾›åº”å•†ï¼Œå»å¹´æ­‰æ”¶æ—¶ä¸»åŠ¨é™ä½äº†ä½ƒå†œçš„ç§Ÿé‡‘ã€‚";
                }
                else if (lowerMessage.includes("å¨å»‰") || lowerMessage.includes("å¡ç‰¹")) {
                    response = "ğŸ“œ **å¨å»‰Â·å¡ç‰¹å…ˆç”Ÿ**æ”¶èµ·çƒŸç›’ï¼Œå¾„ç›´å‘ä½ èµ°æ¥ï¼šã€åšæ—å°å§ï¼Œè¯·åŸè°…æˆ‘çš„å†’æ˜§ï¼Œä½†æˆ‘æ³¨æ„åˆ°æ‚¨å¯¹æ³•å¾‹è®¨è®ºä¼¼ä¹æ„Ÿå…´è¶£ï¼Ÿã€ä»–çš„çœ¼ç›åœ¨ç¬‘ï¼Œé‚£æ˜¯æ™ºè€…åœ¨å‘ç°åŒç±»æ—¶çš„æ„‰æ‚¦ã€‚æœ‰ä¼ è¨€è¯´æŸä½ä¼¯çˆµæ­£è€ƒè™‘è˜è¯·ä»–ä¸ºå®¶æ—å¾‹å¸ˆã€‚";
                }
                else if (lowerMessage.includes("ä¹”æ²»") || lowerMessage.includes("å¥¥æ–¯æœ¬")) {
                    response = "ğŸ•¯ï¸ **ä¹”æ²»Â·å¥¥æ–¯æœ¬ç”·çˆµ**çªç„¶æŠ¬å¤´ï¼Œç›®å…‰ç©¿è¿‡åº­é™¢ç›´ç›´è½åœ¨ä½ èº«ä¸Šã€‚é‚£ç›®å…‰æ·±é‚ƒã€æ¢ç©¶ï¼Œä»¿ä½›èƒ½çœ‹é€è¡¨é¢ç›´è¾¾æœ¬è´¨ã€‚ç„¶åï¼Œä»–å¾®å¾®é¢”é¦–â€”â€”ä¸æ˜¯ç¤¾äº¤è‡´æ„ï¼Œæ›´åƒæ˜¯æŸç§ç¡®è®¤ã€‚ç”·çˆµåº„å›­æœ‰12é—´å§å®¤ä½†åªå¼€æ”¾äº†4é—´ï¼Œè¿™æ˜¯ä¸€ä¸ªè°œã€‚";
                }
                else if (lowerMessage.includes("ä½ å¥½") || lowerMessage.includes("æ‚¨å¥½") || lowerMessage.includes("é—®å€™")) {
                    response = "ğŸ‘‹ ç»…å£«ä»¬çº·çº·å›ç¤¼ï¼šæ¸©æ–¯é¡¿å…ˆç”Ÿèµç¾å¾—ä½“ï¼Œç§‘ç€çˆµå£«ç®€æ´å…³æ³¨ï¼Œéœåå¾·å‹‹çˆµå®Œç¾ä½†ç¼ºä¹æ¸©åº¦ï¼Œæ ¼æ—å…ˆç”Ÿæ†¨åšå¯çˆ±ï¼Œå¡ç‰¹å…ˆç”Ÿæœºæ™ºæ„‰æ‚¦ï¼Œå¥¥æ–¯æœ¬ç”·çˆµæ²‰é»˜æ³¨è§†ã€‚æ¥ä¸‹æ¥ä½ æƒ³ä¸è°æ·±å…¥äº¤è°ˆï¼Ÿ";
                }
                else if (lowerMessage.includes("ç ´äº§") || lowerMessage.includes("è´¢åŠ¡") || lowerMessage.includes("é’±")) {
                    response = "ğŸ¤« æ¯äº²çš„è„¸è‰²ç¬é—´è‹ç™½ï¼šã€å®‰å¦®ï¼Œçœ‹åœ¨ä¸Šå¸çš„ä»½ä¸Šï¼è¿™äº›è¯æ°¸è¿œä¸èƒ½åœ¨å…¬å…±åœºåˆè¯´ï¼æˆ‘ä»¬è¿˜æœ‰æ—¶é—´ï¼Œä½ å¤–ç¥–æ¯çš„çç é¡¹é“¾è¿˜èƒ½å½“150è‹±é•‘ã€‚ä½†æœ€ç»ˆ...ä¸€åˆ‡éƒ½å–å†³äºä½ ï¼Œæˆ‘çš„å­©å­ã€‚ä¸€åœºå¥½å©šå§»ä¸ä»…èƒ½è¿˜æ¸…å€ºåŠ¡ï¼Œè¿˜èƒ½æ¢å¤æˆ‘ä»¬çš„åœ°ä½ã€‚ã€";
                }
                else if (lowerMessage.includes("æ€ä¹ˆåŠ") || lowerMessage.includes("å»ºè®®") || lowerMessage.includes("åº”è¯¥")) {
                    response = "ğŸ’­ **ç­–ç•¥å»ºè®®**ï¼š\n1. **æƒ…æŠ¥æ”¶é›†ï¼ˆç¬¬1-3ä¸ªæœˆï¼‰**ï¼šå‚åŠ ç¤¾äº¤æ´»åŠ¨ï¼Œæ”¶é›†èƒŒæ™¯ä¿¡æ¯\n2. **é‡ç‚¹çªç ´ï¼ˆç¬¬4-8ä¸ªæœˆï¼‰**ï¼šç­›é€‰ç›®æ ‡ï¼Œå»ºç«‹ç§äººå…³ç³»\n3. **æœ€ç»ˆæŠ‰æ‹©ï¼ˆç¬¬9-12ä¸ªæœˆï¼‰**ï¼šè¯„ä¼°å¯èƒ½æ€§ï¼Œåšå‡ºå†³å®š\n\nå…ˆä»ç¤¾äº¤çª¥æ¢å¼€å§‹ï¼Œå¬å¬æœ€æ–°ä¼ è¨€ã€‚";
                }
                else {
                    response = generateDefaultResponse();
                }
                
                // å‘é€å“åº”
                createMessage(responseType === "ai" ? "æ¸¸æˆä¸»æŒ" : responseType === "mother" ? "åšæ—å¤«äºº" : "çå¦®", 
                    response, responseType);
                
                // æ¯æœˆç»“æŸæ—¶æ¨è¿›æ—¶é—´
                if (shouldAdvanceMonth(userMessage)) {
                    advanceMonth();
                }
                
            } catch (error) {
                console.error("AIå“åº”ç”Ÿæˆé”™è¯¯:", error);
                createMessage("ç³»ç»Ÿ", "âš™ï¸ æ¸¸æˆå¼•æ“é‡åˆ°äº†ä¸€ä¸ªè½»å¾®çš„æŠ€æœ¯é—®é¢˜ï¼Œä½†å·²æ¢å¤æ­£å¸¸ã€‚è¯·ç»§ç»­æ‚¨çš„æ¸¸æˆä½“éªŒã€‚", "system", { preventDecoration: true });
                createMessage("æ¸¸æˆä¸»æŒ", "è¯·åŸè°…åˆšæ‰çš„çŸ­æš‚åœé¡¿ã€‚å›åˆ°æˆ‘ä»¬çš„æ•…äº‹â€”â€”æ‚¨åˆšæ‰è¯´åˆ°ï¼Ÿ", "ai");
            }
        }

        // ç”Ÿæˆé»˜è®¤å“åº”
        function generateDefaultResponse() {
            const currentScene = gameState.currentScene;
            
            const defaultResponses = {
                church: [
                    "â›ª æ•™å ‚é’Ÿå£°å†æ¬¡å“èµ·ï¼Œæé†’äººä»¬è¯¥ç¦»å¼€äº†ã€‚ç‰§å¸ˆåœ¨é—¨å£ä¸æ¯ä¸ªäººé“åˆ«ã€‚ä½ æ³¨æ„åˆ°æ¸©æ–¯é¡¿å…ˆç”Ÿæ­£æœä½ çš„æ–¹å‘çœ‹æ¥ï¼Œä¼¼ä¹æƒ³æ‰¾æœºä¼šäº¤è°ˆã€‚",
                    "ğŸ‚ ç§‹é£çªç„¶è½¬å¼ºï¼Œå·èµ·åº­é™¢ä¸­çš„è½å¶å½¢æˆå°å°çš„é‡‘è‰²æ—‹é£ã€‚æ ¼æ—å…ˆç”Ÿæœ¬èƒ½åœ°ä¾§èº«ä¸ºå¦¹å¦¹æŒ¡é£ï¼Œè¿™ä¸ªå°åŠ¨ä½œæ˜¾ç¤ºå‡ºä»–ä¿æŠ¤å®¶äººçš„æœ¬èƒ½ã€‚",
                    "ğŸ•°ï¸ æ—¶é—´æ‚„ç„¶æµé€ï¼Œæ¯äº²è½»è½»ç¢°äº†ç¢°ä½ çš„æ‰‹è‡‚ï¼šã€è¯¥å›å®¶äº†ï¼Œå®‰å¦®ã€‚æˆ‘ä»¬å¯ä»¥é©¬è½¦ä¸Šè®¨è®ºä»Šå¤©çš„è§‚å¯Ÿã€‚ã€"
                ],
                default: [
                    "ğŸ’­ ä½ çš„è¯è¯­åœ¨ç¤¾äº¤åœºåˆä¸­å¾—ä½“è€Œæ°å½“ã€‚è®°ä½ï¼Œæ¯ä½ç»…å£«éƒ½åœ¨è§‚å¯Ÿä½ ï¼Œæ­£å¦‚ä½ åœ¨è§‚å¯Ÿä»–ä»¬ã€‚",
                    "ğŸ­ åœ¨è‹±æ ¼å…°ä¹¡æ‘çš„ç¤¾äº¤èˆå°ä¸Šï¼Œæ¯ä¸ªå¾®ç¬‘ã€æ¯æ¬¡ç‚¹å¤´ã€æ¯å¥é—®å€™éƒ½æ‰¿è½½ç€å¤šé‡å«ä¹‰ã€‚",
                    "ğŸ“– åƒç®€Â·å¥¥æ–¯æ±€ç¬”ä¸‹çš„å¥³ä¸»è§’ä¸€æ ·ï¼Œä½ é¢ä¸´ç€ç›¸ä¼¼çš„å›°å¢ƒä¸é€‰æ‹©ã€‚"
                ]
            };
            
            const sceneResponses = defaultResponses[currentScene] || defaultResponses.default;
            const randomIndex = Math.floor(Math.random() * sceneResponses.length);
            let response = sceneResponses[randomIndex];
            
            // æ ¹æ®æœˆä»½æ·»åŠ æ—¶é—´æç¤º
            if (gameState.currentMonth >= 10) {
                response += "\n\nâš ï¸ æ—¶é—´æé†’ï¼šåªå‰©ä¸‹" + (12 - gameState.currentMonth) + "ä¸ªæœˆäº†ã€‚";
            }
            
            return response;
        }

        // åˆ¤æ–­æ˜¯å¦åº”è¯¥æ¨è¿›æœˆä»½
        function shouldAdvanceMonth(userMessage) {
            const isSignificantAction = userMessage.length > 20 || 
                userMessage.includes("æ‹œè®¿") || 
                userMessage.includes("å†™ä¿¡") || 
                userMessage.includes("å‚åŠ ");
            
            const randomChance = Math.random() > 0.85;
            
            return (isSignificantAction && randomChance) && gameState.currentMonth < gameState.totalMonths;
        }

        // æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªæœˆ
        function advanceMonth() {
            gameState.currentMonth++;
            gameState.actionPoints = 3; // æ¯æœˆé‡ç½®è¡ŒåŠ¨ç‚¹
            
            // æ›´æ–°å­£èŠ‚
            if (gameState.currentMonth <= 3) {
                gameState.season = "ç§‹å­£";
            } else if (gameState.currentMonth <= 8) {
                gameState.season = "å†¬å­£";
            } else if (gameState.currentMonth <= 11) {
                gameState.season = "æ˜¥å­£";
            } else {
                gameState.season = "å¤å­£ç»ˆå±€";
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateStatusDisplay();
            updateActionPointsDisplay();
            updateActionButtons();
            
            // æ¯æœˆå¼€å§‹æ¶ˆæ¯
            setTimeout(() => {
                createMessage("ç³»ç»Ÿ", 
                    `ğŸ“… **ç¬¬${gameState.currentMonth}/12ä¸ªæœˆå¼€å§‹** - ${gameState.season}`, 
                    "system"
                );
                
                let seasonDescription = "";
                if (gameState.season === "å†¬å­£") {
                    seasonDescription = "â„ï¸ å†¬å­£æ¥ä¸´ï¼Œå¤§åœ°é“¶è£…ç´ è£¹ã€‚ç¤¾äº¤æ´»åŠ¨è½¬å…¥æ¸©æš–çš„å®¤å†…ã€‚";
                } else if (gameState.season === "æ˜¥å­£") {
                    seasonDescription = "ğŸŒ¸ æ˜¥å¤©åˆ°æ¥ï¼Œä¸‡ç‰©å¤è‹ã€‚æ±‚å©šçª—å£æœŸæ­£å¼å¼€å¯ï¼";
                } else if (gameState.season === "å¤å­£ç»ˆå±€") {
                    seasonDescription = "â˜€ï¸ æœ€åä¸€ä¸ªæœˆï¼å¤å­£ç»ˆå±€ï¼Œæ”¶è·æˆ–æ¯ç­çš„æ—¶åˆ»ã€‚";
                } else {
                    seasonDescription = "ğŸ‚ ç§‹å­£ç»§ç»­ï¼Œç¤¾äº¤å­£èŠ‚æ·±å…¥ã€‚å…³ç³»å¼€å§‹å·©å›ºã€‚";
                }
                
                createMessage("ç³»ç»Ÿ", seasonDescription, "system");
                
                // éšæœºäº‹ä»¶
                if (Math.random() > 0.4 && gameState.currentMonth < 12) {
                    triggerRandomEvent();
                }
                
                // æ¯æœˆæç¤º
                setTimeout(() => {
                    createMessage("æ¸¸æˆä¸»æŒ", `å…‰é˜´ä¼¼ç®­ï¼Œç°åœ¨æ˜¯ç¬¬${gameState.currentMonth}ä¸ªæœˆã€‚ä½ æœ‰3ä¸ªè¡ŒåŠ¨ç‚¹å¯ä»¥æ”¯é…ã€‚æ˜æ™ºåœ°é€‰æ‹©ä½ çš„ç­–ç•¥ã€‚`, "ai");
                }, 1000);
                
            }, 800);
        }

        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            const events = [
                {
                    key: "rose_garden",
                    message: "ğŸŒ¹ **åº„å›­ç«ç‘°å›­çš„æ„å¤–å‘ç°**\n\nä½ ç‹¬è‡ªåœ¨å®¶æ—ç«ç‘°å›­æ•£æ­¥ï¼Œåœ¨æœ€å¤è€çš„ä¸€ä¸›ç«ç‘°ä¸‹å‘ç°äº†ä¸€ä¸ªæ¾åŠ¨çš„çŸ³æ¿ã€‚é‡Œé¢æ˜¯ä¸€ä¸ªç”Ÿé”ˆçš„é“ç›’ï¼Œè£…ç€ä½ æ›¾ç¥–æ¯çš„æ—¥è®°å’Œå‡ ä»¶æœ´ç´ ä½†ç²¾è‡´çš„ç å®ã€‚",
                    effect: { reputation: +5 }
                },
                {
                    key: "library_encounter",
                    message: "ğŸ“š **æ•™å ‚å›¾ä¹¦å®¤çš„å¶é‡**\n\nä½ åœ¨æ•™å ‚å›¾ä¹¦å®¤å¯»æ‰¾å›­è‰ºä¹¦ï¼Œå´æ„å¤–é‡åˆ°äº†å¨å»‰Â·å¡ç‰¹å¾‹å¸ˆã€‚ä»–æ­£åœ¨æŸ¥é˜…ã€Šè´¢äº§æ³•ã€‹æ³¨é‡Šæœ¬ï¼šã€åšæ—å°å§ï¼ŒçœŸå·§ã€‚æˆ‘åœ¨ç ”ç©¶é™å®šç»§æ‰¿æƒçš„ä¾‹å¤–æ¡æ¬¾...ã€",
                    effect: { relationship: { "å¨å»‰Â·å¡ç‰¹": +10 } }
                },
                {
                    key: "market_rumor",
                    message: "ğŸ›’ **é›†å¸‚ä¸Šçš„æ„å¤–æƒ…æŠ¥**\n\né™ªæ¯äº²å»é›†å¸‚æ—¶ï¼Œä½ æ— æ„ä¸­å¬åˆ°å•†äººå¯¹è¯ï¼šã€æ¸©æ–¯é¡¿å…ˆç”Ÿåˆè®¢è´­äº†50ç£…æœ€å¥½çš„å’–å•¡è±†ï¼Œçœ‹æ¥ä»–è¦åœ¨å®…é‚¸ä¸¾åŠå¤§å‹æ´»åŠ¨ã€‚ã€",
                    effect: { clue: "æ¸©æ–¯é¡¿å°†åŠå¤§å‹èˆä¼š" }
                }
            ];
            
            const availableEvents = events.filter(event => !gameState.usedEvents.has(event.key));
            
            if (availableEvents.length > 0) {
                const randomEvent = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                gameState.usedEvents.add(randomEvent.key);
                
                setTimeout(() => {
                    createMessage("ç³»ç»Ÿ", "ğŸ“Œ **æœ¬æœˆç‰¹æ®Šäº‹ä»¶**", "system");
                    createMessage("æ¸¸æˆä¸»æŒ", randomEvent.message, "ai");
                    
                    if (randomEvent.effect.reputation) {
                        gameState.reputationValue += randomEvent.effect.reputation;
                        if (gameState.reputationValue > 90) gameState.reputation = "æä½³";
                        else if (gameState.reputationValue > 70) gameState.reputation = "è‰¯å¥½";
                        updateStatusDisplay();
                    }
                }, 1500);
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
        function setupEventListeners() {
            document.getElementById('send-btn').addEventListener('click', handleUserMessage);
            
            document.getElementById('user-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleUserMessage();
                }
            });
            
            // é˜²æ­¢é‡å¤å¿«é€Ÿç‚¹å‡»
            let lastClickTime = 0;
            document.getElementById('send-btn').addEventListener('click', function() {
                const now = Date.now();
                if (now - lastClickTime < 1000) {
                    return;
                }
                lastClickTime = now;
            });
            
            // è¡ŒåŠ¨æŒ‰é’®åŒºåŸŸæ»šåŠ¨ä¼˜åŒ–
            const actionButtonsContainer = document.getElementById('action-buttons-container');
            let isScrolling = false;
            
            actionButtonsContainer.addEventListener('wheel', function(e) {
                if (!isScrolling) {
                    isScrolling = true;
                    this.scrollLeft += e.deltaY;
                    setTimeout(() => {
                        isScrolling = false;
                    }, 50);
                }
                e.preventDefault();
            });
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            initGame();
            setupEventListeners();
            
            // é¢„åŠ è½½æç¤º
            console.log("æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼Œè´µæ—é£æ ¼ç•Œé¢å·²åŠ è½½");
        };
    </script>
</body>
</html>